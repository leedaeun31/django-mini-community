{% extends 'main/base.html' %}

{% block content %}
{% if user.is_authenticated %}
<div class="container">
    <h1>ë°© ìƒì„± í˜ì´ì§€</h1>

    <!-- ë°© ì´ë¦„ ì…ë ¥ í¼ -->
    <form method="post" class="create-form">
        {% csrf_token %}
        <input type="text" name="name" placeholder="ë°© ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" required>
        <input type="text" name="password" placeholder="PIN ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš” (4ê¸€ì)"  pattern="\d{4}"  maxlength="4" required> 
        <button type="submit">ë°© ìƒì„±í•˜ê¸°</button>
    </form>
</div>

<!-- ëª¨ë‹¬ -->
<div id="roomModal" class="modal">
    <div class="modal-content">
        <button class="close-btn" id="closeModal">&times;</button>
        <h2>ë°©ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!</h2>
        <p id="roomLink"></p>
        <button class="copy-btn" id="copyLink">ì´ˆëŒ€ì½”ë“œ ë³µì‚¬</button>
    </div>
</div>

<style>
    /* ì»¨í…Œì´ë„ˆ ì¤‘ì•™ ì •ë ¬ */
    .container {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 60vh; /* í™”ë©´ ë†’ì´ì— ë§ì¶° ì¤‘ì•™ ì •ë ¬ */
        text-align: center;
        padding: 20px;
    }

    .container h1 {
        font-size: 2rem;
        margin-bottom: 20px;
    }

    /* í¼ ìŠ¤íƒ€ì¼ */
    .create-form {
        display: flex;
        flex-direction: column;
        gap: 15px;
        width: 100%;
        max-width: 400px; /* í™”ë©´ í¬ê¸°ì— ë”°ë¼ í¬ê¸° ìë™ ì¡°ì • */
    }

    .create-form input[type="text"] {
        padding: 10px;
        font-size: 1rem;
        border: 1px solid #ccc;
        border-radius: 8px;
        text-align: center;
    }

    .create-form button {
        background: #ecaddfb9; /* ë¶„í™ìƒ‰ */
        color: #000000;
        padding: 10px;
        border: none;
        border-radius: 8px;
        font-size: 1rem;
        cursor: pointer;
        transition: background 0.3s ease;
    }

    .create-form button:hover {
        background: #fd6bdeb9; /* hoverì‹œ ì¢€ ë” ì§„í•œ ë¶„í™ìƒ‰ */
    }

    /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
    .modal {
        display: none;
        position: fixed;
        top: 0; left: 0;
        width: 100%; height: 100%;
        background: rgba(0,0,0,0.5);
        justify-content: center;
        align-items: center;
        z-index: 1000;
    }

    .modal-content {
        background: #fff;
        padding: 20px;
        border-radius: 10px;
        text-align: center;
        width: 90%;
        max-width: 350px;
        position: relative;
    }

    .modal-content h2 {
        font-size: 18px;
        margin-bottom: 10px;
    }

    .modal-content p {
        word-break: break-all;
        margin-bottom: 10px;
    }

    .close-btn {
        position: absolute;
        top: 8px;
        right: 10px;
        cursor: pointer;
        font-size: 20px;
        border: none;
        background: none;
    }

    .copy-btn {
        padding: 5px 10px;
        background: #ecaddfb9; /* ë¶„í™ìƒ‰ ë²„íŠ¼ */
        color: #fff;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: background 0.3s ease;
    }

    .copy-btn:hover {
        background: #fd6bdeb9;
    }

    /* ë°˜ì‘í˜•: í™”ë©´ì´ ì‘ì•„ì§ˆ ë•Œë„ ì¤‘ì•™ ë°°ì¹˜ ìœ ì§€ */
    @media (max-width: 480px) {
        .container h1 {
            font-size: 1.5rem;
        }
        .create-form input[type="text"] {
            font-size: 0.9rem;
        }
        .create-form button {
            font-size: 0.9rem;
        }
    }
</style>
{% endif %}

<script>
document.addEventListener("DOMContentLoaded", function () {
    {% if room %}
    const modal = document.getElementById('roomModal');
    const closeBtn = document.getElementById('closeModal');
    const copyBtn = document.getElementById('copyLink');
    const roomLinkElem = document.getElementById('roomLink');

    // ğŸ”¹ ì „ì²´ URL ëŒ€ì‹  UUIDë§Œ í‘œì‹œ
    const inviteCode = "{{ room.slug }}";
    roomLinkElem.innerText = inviteCode;

    // ëª¨ë‹¬ ì—´ê¸°
    modal.style.display = 'flex';

    // ë‹«ê¸° ë²„íŠ¼ ì´ë²¤íŠ¸
    closeBtn.addEventListener('click', () => {
        modal.style.display = 'none';
    });

    // ë³µì‚¬ ë²„íŠ¼ ì´ë²¤íŠ¸ (UUID ë³µì‚¬)
    copyBtn.addEventListener('click', () => {
        navigator.clipboard.writeText(inviteCode)
            .then(() => alert('ì´ˆëŒ€ì½”ë“œê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!'))
            .catch(err => console.error('ë³µì‚¬ ì‹¤íŒ¨', err));
    });
    {% endif %}
});
</script>
{% endblock %}
